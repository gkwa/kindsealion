#!/usr/bin/env bash

set -e
set -u
set -x


start_time=$(date +%s)
end_time=$((start_time + 30))
consecutive_successes=0

while [ $consecutive_successes -lt 3 ]; do
 if ping -c 1 google.com &> /dev/null; then
   ((consecutive_successes++))
 else
   consecutive_successes=0
 fi

 current_time=$(date +%s)
 time_remaining=$((end_time - current_time))

 if [ $time_remaining -le 0 ]; then
   echo "Time limit of 30 seconds reached without achieving 3 consecutive successes."
   exit 1
 fi

 echo "Time remaining: $time_remaining seconds"
 sleep 1
done

echo "3 consecutive successful pings to google.com achieved within 30 seconds."
exit 0
